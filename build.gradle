plugins {
    id 'com.diffplug.gradle.spotless' version '3.26.1'
    id 'java-library'
}

allprojects {
    def PLUGIN_VERSION = '0.0.22-SNAPSHOT'

    group 'com.virtuslab'
    version PLUGIN_VERSION

    repositories {
        jcenter()
        mavenCentral()
    }


    apply plugin: 'java'
    sourceCompatibility = 11

    apply plugin: 'com.diffplug.gradle.spotless'
    spotless {
        java {
            importOrderFile "${rootProject.projectDir}/our.importorder"
            eclipse().configFile "${rootProject.projectDir}/formatting-rules.xml"
            removeUnusedImports()
        }
    }

    apply plugin: 'java-library'

    ext {
        junitVersion = '4.13'
        powerMockVersion = '2.0.5'
        lombokVersion = '1.18.10'
        guiceVersion = '4.2.2'
        slf4jVersion = '1.7.25'
        jgitVersion = '5.5.1.201910021850-r'
        javafxVersion = '11'

        lombok = { ->
            dependencies {
                compileOnly group: 'org.projectlombok', name: 'lombok', version: lombokVersion
                annotationProcessor group: 'org.projectlombok', name: 'lombok', version: lombokVersion
            }
        }

        guice = { ->
            dependencies {
                implementation group: 'com.google.inject', name: 'guice', version: guiceVersion
                implementation group: 'com.google.inject.extensions', name: 'guice-assistedinject', version: guiceVersion
            }
        }

        javafx = { ->
            dependencies {
                implementation group: 'org.openjfx', name: 'javafx', version: javafxVersion, ext: 'pom'
            }
        }

        slf4j = { ->
            dependencies {
                implementation group: 'org.slf4j', name: 'slf4j-simple', version: slf4jVersion
            }
        }

        jgit = { ->
            slf4j()
            dependencies {
                implementation group: 'org.eclipse.jgit', name: 'org.eclipse.jgit', version: jgitVersion
            }
        }
    }

    dependencies {
        testImplementation group: 'junit', name: 'junit', version: junitVersion
        testImplementation group: 'org.powermock', name: 'powermock-module-junit4', version: powerMockVersion
        testImplementation group: 'org.powermock', name: 'powermock-api-mockito2', version: powerMockVersion
    }
}

afterEvaluate {
    tasks.getByName('spotlessCheck').dependsOn(tasks.getByName('spotlessApply'))
}
